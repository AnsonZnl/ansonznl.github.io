"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7769],{2676:(n,s,a)=>{a.r(s),a.d(s,{data:()=>p});const p={key:"v-5ad0c968",path:"/articles/Vue/%E4%B8%80%E6%AC%A1%E6%90%9E%E6%87%82-Vue%E4%B9%8B%E8%99%9A%E6%8B%9FDOM.html",title:"Vue 之虚拟 DOM",lang:"en-US",frontmatter:{},excerpt:"",headers:[{level:2,title:"介绍",slug:"介绍",children:[{level:3,title:"为什么要学习虚拟 DOM",slug:"为什么要学习虚拟-dom",children:[]},{level:3,title:"什么是虚拟 DOM",slug:"什么是虚拟-dom",children:[]},{level:3,title:"为什么要用虚拟 DOM？",slug:"为什么要用虚拟-dom",children:[]}]},{level:2,title:"实现一个虚拟 DOM",slug:"实现一个虚拟-dom",children:[{level:3,title:"创建虚拟 DOM",slug:"创建虚拟-dom",children:[]},{level:3,title:"生成真实 DOM",slug:"生成真实-dom",children:[]},{level:3,title:"使用",slug:"使用",children:[]}]},{level:2,title:"Diff 算法",slug:"diff-算法",children:[{level:3,title:"结语",slug:"结语",children:[]}]},{level:2,title:"参考",slug:"参考",children:[]}],filePathRelative:"articles/Vue/一次搞懂-Vue之虚拟DOM.md",git:{}}},1961:(n,s,a)=>{a.r(s),a.d(s,{default:()=>U});var p=a(6252);const t=(0,p.uE)('<h1 id="vue-之虚拟-dom" tabindex="-1"><a class="header-anchor" href="#vue-之虚拟-dom" aria-hidden="true">#</a> Vue 之虚拟 DOM</h1><h2 id="介绍" tabindex="-1"><a class="header-anchor" href="#介绍" aria-hidden="true">#</a> 介绍</h2><h3 id="为什么要学习虚拟-dom" tabindex="-1"><a class="header-anchor" href="#为什么要学习虚拟-dom" aria-hidden="true">#</a> 为什么要学习虚拟 DOM</h3><p>尤大推荐，Vue.js 在用。 <img src="https://i.loli.net/2021/05/21/YmWge4I37CBz5Ji.png" alt="learnvDom.png"></p><h3 id="什么是虚拟-dom" tabindex="-1"><a class="header-anchor" href="#什么是虚拟-dom" aria-hidden="true">#</a> 什么是虚拟 DOM</h3><blockquote><p>就是用 JS 去按照 DOM 结构来实现的树形结构对象，你也可以叫做 DOM 对象</p></blockquote><p>比如：下边的 HTML 结构可以使用 JavaScript 对象的形式表达出来。</p><p>HTMl</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Item 1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Item 2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Item 3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>JavaScript</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> element <span class="token operator">=</span> <span class="token punctuation">{</span>\n  tagName<span class="token operator">:</span> <span class="token string">&quot;ul&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 节点标签名</span>\n  props<span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token comment">// DOM的属性，用一个对象存储键值对</span>\n    id<span class="token operator">:</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  children<span class="token operator">:</span> <span class="token punctuation">[</span>\n    <span class="token comment">// 该节点的子节点</span>\n    <span class="token punctuation">{</span> tagName<span class="token operator">:</span> <span class="token string">&quot;li&quot;</span><span class="token punctuation">,</span> props<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">&quot;item&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> children<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Item 1&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">{</span> tagName<span class="token operator">:</span> <span class="token string">&quot;li&quot;</span><span class="token punctuation">,</span> props<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">&quot;item&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> children<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Item 2&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">{</span> tagName<span class="token operator">:</span> <span class="token string">&quot;li&quot;</span><span class="token punctuation">,</span> props<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">&quot;item&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> children<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Item 3&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token punctuation">]</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>然后在通过<code>createElement</code>等 DOM API 操作完成从 JavaScript 对象=》真实 DOM 的转化。</p><h3 id="为什么要用虚拟-dom" tabindex="-1"><a class="header-anchor" href="#为什么要用虚拟-dom" aria-hidden="true">#</a> 为什么要用虚拟 DOM？</h3><ol><li>操作真实 DOM 花销很大，引起重绘、回流等</li><li>减少不必要的开销比如三个列表，比如现在替换一种一个列表，通过 diff 后，只需要操作一次列表（局部变动），这样可以提升性能。</li><li>其他的比如跨平台（RN、Weex、Flutter），组件的高度抽象化、可以更好的实现 SSR、同构渲染等</li></ol><h2 id="实现一个虚拟-dom" tabindex="-1"><a class="header-anchor" href="#实现一个虚拟-dom" aria-hidden="true">#</a> 实现一个虚拟 DOM</h2><p>使用 JavaScript 的对象结构去描述一个 DOM，然后渲染到页面上。 第一步：得有一个创建虚拟 DOM 的方法（称为 createElement） 第二步：通过虚拟 DOM 生成真实 DOM 的方法（render） 第三步：将生成后的真实 DOM 插入页面中(renderDom)</p><h3 id="创建虚拟-dom" tabindex="-1"><a class="header-anchor" href="#创建虚拟-dom" aria-hidden="true">#</a> 创建虚拟 DOM</h3><p>先来了解一个基本的 DOM 的组成:</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Item 1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>分别对应三个属性：</p><ul><li>type：<code>div</code></li><li>props: <code>id=&quot;list&quot;</code></li><li>children：<code>{type: &quot;li&quot;,props:{class:&quot;item&quot;},children:&quot;Item 1&quot;}</code></li></ul><p>明确了属性和值，我们可以借助构造函数去批量的创建虚拟 DOM 了，</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// element.js</span>\n<span class="token keyword">class</span> <span class="token class-name">Element</span> <span class="token punctuation">{</span>\n  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> type<span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>props <span class="token operator">=</span> props<span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>children <span class="token operator">=</span> children<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><code>createElement</code>函数，用于将创建后的虚拟 DOM 返回</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// createElement.js</span>\n<span class="token keyword">function</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Element</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="生成真实-dom" tabindex="-1"><a class="header-anchor" href="#生成真实-dom" aria-hidden="true">#</a> 生成真实 DOM</h3><p>通过一个 render 函数将 vDOM 转化为真实的 DOM。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// render.js</span>\n<span class="token comment">// render 方法可以将虚拟DOM转化为真是的DOM</span>\n<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">vDom</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">let</span> <span class="token punctuation">{</span> type<span class="token punctuation">,</span> props<span class="token punctuation">,</span> children <span class="token punctuation">}</span> <span class="token operator">=</span> vDom<span class="token punctuation">;</span>\n  <span class="token comment">// 创建元素</span>\n  <span class="token keyword">let</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// 遍历props，设置属性</span>\n  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> props<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">setAttr</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> key<span class="token punctuation">,</span> props<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token comment">// 遍历子节点</span>\n  <span class="token comment">// 如果是虚拟DOM，就递归</span>\n  <span class="token comment">// 不是就是文本节点，直接创建</span>\n  children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">childEl</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    childEl <span class="token operator">=</span>\n      childEl <span class="token keyword">instanceof</span> <span class="token class-name">Element</span>\n        <span class="token operator">?</span> <span class="token function">render</span><span class="token punctuation">(</span>childEl<span class="token punctuation">)</span>\n        <span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>childEl<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    el<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>childEl<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// 创建完毕返回节点</span>\n  <span class="token keyword">return</span> el<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token comment">// 设置属性</span>\n<span class="token keyword">function</span> <span class="token function">setAttr</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">===</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 如果是value，则表明是input、textarea节点</span>\n    <span class="token keyword">let</span> tagName <span class="token operator">=</span> node<span class="token punctuation">.</span>tagName<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>tagName <span class="token operator">==</span> <span class="token string">&quot;input&quot;</span> <span class="token operator">||</span> tagName <span class="token operator">==</span> <span class="token string">&quot;textarea&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      node<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n      node<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">===</span> <span class="token string">&quot;style&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 直接设置的行内样式</span>\n    node<span class="token punctuation">.</span>style<span class="token punctuation">.</span>cssText <span class="token operator">=</span> value<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 设置的属性 比如class、id、dataset等</span>\n    node<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><p>通过 renderDom 将生成后的真实 DOM 挂载到制定的元素上</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// renderDom.js</span>\n<span class="token comment">// 将生成的真实DOM，添加到目标元素中</span>\n<span class="token keyword">function</span> <span class="token function">renderDom</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  target<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="使用" tabindex="-1"><a class="header-anchor" href="#使用" aria-hidden="true">#</a> 使用</h3><p>接下来，就是见证奇迹的时刻了</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// index.js</span>\n<span class="token comment">// 描述虚拟DOM的JS对象</span>\n<span class="token keyword">let</span> jsDomObj <span class="token operator">=</span> <span class="token punctuation">{</span>\n  type<span class="token operator">:</span> <span class="token string">&quot;ul&quot;</span><span class="token punctuation">,</span>\n  props<span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  children<span class="token operator">:</span> <span class="token punctuation">[</span>\n    <span class="token function">createElement</span><span class="token punctuation">(</span>\n      <span class="token string">&quot;li&quot;</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n        <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">&quot;item&quot;</span><span class="token punctuation">,</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">[</span><span class="token string">&quot;周杰伦&quot;</span><span class="token punctuation">]</span>\n    <span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token function">createElement</span><span class="token punctuation">(</span>\n      <span class="token string">&quot;li&quot;</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n        <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">&quot;item&quot;</span><span class="token punctuation">,</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">[</span><span class="token string">&quot;林俊杰&quot;</span><span class="token punctuation">]</span>\n    <span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token function">createElement</span><span class="token punctuation">(</span>\n      <span class="token string">&quot;li&quot;</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n        <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">&quot;item&quot;</span><span class="token punctuation">,</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">[</span><span class="token string">&quot;王力宏&quot;</span><span class="token punctuation">]</span>\n    <span class="token punctuation">)</span><span class="token punctuation">,</span>\n  <span class="token punctuation">]</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token comment">// 通过createElement将JS对象转化为虚拟DOM</span>\n<span class="token keyword">let</span> virtualDom <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span>\n  jsDomObj<span class="token punctuation">.</span>type<span class="token punctuation">,</span>\n  jsDomObj<span class="token punctuation">.</span>props<span class="token punctuation">,</span>\n  jsDomObj<span class="token punctuation">.</span>children\n<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 打印 虚拟DOM</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;虚拟DOM\\n&quot;</span><span class="token punctuation">,</span> virtualDom<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 渲染虚拟DOM得到真实的DOM结构</span>\n<span class="token keyword">let</span> el <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span>virtualDom<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 打印 真实DOM</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;真实DOM\\n&quot;</span><span class="token punctuation">,</span> el<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 直接将DOM添加到页面内</span>\n<span class="token function">renderDom</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><p>打开页面后，发现了 list 渲染成功！！ <img src="https://i.loli.net/2021/05/21/BwVA41jIMfo9J7m.png" alt="vDom2.png"> 我们可以查看控制台打印的结果： <img src="https://i.loli.net/2021/05/21/CspGVoALWk9tQ4x.png" alt="vDomandrDom.png"></p><h2 id="diff-算法" tabindex="-1"><a class="header-anchor" href="#diff-算法" aria-hidden="true">#</a> Diff 算法</h2><p>这就是所谓的 Virtual DOM 算法。包括几个步骤：</p><ol><li>用 JavaScript 对象结构表示 DOM 树的结构；然后用这个树构建一个真正的 DOM 树，插到文档当中当状态变更的时候，重新构造一棵新的对象树。</li><li>然后用新的树和旧的树进行比较，记录两棵树差异把 2 所记录的差异应用到步骤 1 所构建的真正的 DOM 树上，视图就更新了 Virtual DOM 本质上就是在 JS 和 DOM 之间做了一个缓存。</li></ol><p>可以类比 CPU 和硬盘，既然硬盘这么慢，我们就在它们之间加个缓存：既然 DOM 这么慢，我们就在它们 JS 和 DOM 之间加个缓存。CPU（JS）只操作内存（Virtual DOM），最后的时候再把变更写入硬盘（DOM）。</p><h3 id="结语" tabindex="-1"><a class="header-anchor" href="#结语" aria-hidden="true">#</a> 结语</h3><p>Vue 编译也分两个版本</p><ul><li>一个是运行时+编译器，比如使用 vue-cli，是通过 webpack 的 vue-loader 将模板编译成真实 DOM 的</li><li>一个是运行时，比如直接使用 CDN 将整个 Vue 代码引入到项目当中，则使用 render 方法编译的。</li></ul>',41),e=(0,p.Uk)("Vue.js 使用的 Virtual DOM 参考的是开源库 "),o={href:"https://github.com/snabbdom/snabbdom",target:"_blank",rel:"noopener noreferrer"},l=(0,p.Uk)("github-snabbdom"),c=(0,p.Uk)(" 有兴趣的可以看一下他的源码。"),u=(0,p.Uk)("感谢"),r={href:"https://github.com/Matt-Esch/virtual-dom",target:"_blank",rel:"noopener noreferrer"},i=(0,p.Uk)("Matt-Esch/virtual-dom"),k=(0,p.Uk)("项目，带来的帮助。"),m=(0,p._)("p",null,"完整代码地址：https://github.com/AnsonZnl/virtual-dom-study",-1),b=(0,p._)("h2",{id:"参考",tabindex:"-1"},[(0,p._)("a",{class:"header-anchor",href:"#参考","aria-hidden":"true"},"#"),(0,p.Uk)(" 参考")],-1),d={href:"https://juejin.cn/post/6844903806132568072",target:"_blank",rel:"noopener noreferrer"},h=(0,p.Uk)("让虚拟 DOM 不在成为你的绊脚石"),g={href:"https://juejin.cn/post/6844903895467032589",target:"_blank",rel:"noopener noreferrer"},v=(0,p.Uk)("深入剖析：Vue 核心之虚拟 DOM"),f={href:"https://juejin.cn/post/6844903850520870926",target:"_blank",rel:"noopener noreferrer"},q=(0,p.Uk)("我们真的需要虚拟 DOM 吗？"),D={href:"https://www.jianshu.com/p/af0b398602bc",target:"_blank",rel:"noopener noreferrer"},M=(0,p.Uk)("Vue 核心之虚拟 DOM"),O={href:"https://github1s.com/vuejs/vue/blob/HEAD/src/core/vdom/vnode.js",target:"_blank",rel:"noopener noreferrer"},y=(0,p.Uk)("Vue2.x-vnode 源码"),w={href:"https://ustbhuangyi.github.io/vue-analysis/v2/data-driven/virtual-dom.html",target:"_blank",rel:"noopener noreferrer"},j=(0,p.Uk)("Vue.js 技术揭秘之 Vdom"),E={href:"https://github.com/snabbdom/snabbdom",target:"_blank",rel:"noopener noreferrer"},_=(0,p.Uk)("Github-snabbdom"),x={href:"https://blog.csdn.net/dongcehao/article/details/107428437",target:"_blank",rel:"noopener noreferrer"},V=(0,p.Uk)("Vue3 的 Diff"),U={render:function(n,s){const a=(0,p.up)("OutboundLink");return(0,p.wg)(),(0,p.iD)(p.HY,null,[t,(0,p._)("p",null,[e,(0,p._)("a",o,[l,(0,p.Wm)(a)]),c]),(0,p._)("p",null,[u,(0,p._)("a",r,[i,(0,p.Wm)(a)]),k]),m,b,(0,p._)("ul",null,[(0,p._)("li",null,[(0,p._)("a",d,[h,(0,p.Wm)(a)])]),(0,p._)("li",null,[(0,p._)("a",g,[v,(0,p.Wm)(a)])]),(0,p._)("li",null,[(0,p._)("a",f,[q,(0,p.Wm)(a)])]),(0,p._)("li",null,[(0,p._)("a",D,[M,(0,p.Wm)(a)])]),(0,p._)("li",null,[(0,p._)("a",O,[y,(0,p.Wm)(a)])]),(0,p._)("li",null,[(0,p._)("a",w,[j,(0,p.Wm)(a)])]),(0,p._)("li",null,[(0,p._)("a",E,[_,(0,p.Wm)(a)])]),(0,p._)("li",null,[(0,p._)("a",x,[V,(0,p.Wm)(a)])])])],64)}}}}]);