"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1350],{4554:(n,s,a)=>{a.r(s),a.d(s,{data:()=>e});const e={key:"v-68dae955",path:"/articles/WeApp/%E5%85%AC%E4%BC%97%E5%8F%B7%E7%BD%91%E9%A1%B5%E5%BC%80%E5%8F%91%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93.html",title:"公众号网页开发经验总结",lang:"en-US",frontmatter:{},excerpt:"",headers:[{level:2,title:"内网穿透",slug:"内网穿透",children:[]},{level:2,title:"移动端调试神器",slug:"移动端调试神器",children:[]},{level:2,title:"微信公众号开发文档",slug:"微信公众号开发文档",children:[]},{level:2,title:"如何让网页只在微信内打开",slug:"如何让网页只在微信内打开",children:[]},{level:2,title:"公众号内保持登录状态",slug:"公众号内保持登录状态",children:[]},{level:2,title:"ios 端的时间格式问题",slug:"ios-端的时间格式问题",children:[]},{level:2,title:"判断设备",slug:"判断设备",children:[]},{level:2,title:"扫码关注公众号登录网站",slug:"扫码关注公众号登录网站",children:[]},{level:2,title:"微信 H5 页面兼容的坑",slug:"微信-h5-页面兼容的坑",children:[]}],filePathRelative:"articles/WeApp/公众号网页开发经验总结.md",git:{}}},4351:(n,s,a)=>{a.r(s),a.d(s,{default:()=>z});var e=a(6252);const p=(0,e._)("h1",{id:"公众号网页开发经验总结",tabindex:"-1"},[(0,e._)("a",{class:"header-anchor",href:"#公众号网页开发经验总结","aria-hidden":"true"},"#"),(0,e.Uk)(" 公众号网页开发经验总结")],-1),t=(0,e._)("h2",{id:"内网穿透",tabindex:"-1"},[(0,e._)("a",{class:"header-anchor",href:"#内网穿透","aria-hidden":"true"},"#"),(0,e.Uk)(" 内网穿透")],-1),o=(0,e.Uk)("sunny-Ngrok："),l={href:"https://www.ngrok.cc",target:"_blank",rel:"noopener noreferrer"},c=(0,e.Uk)("https://www.ngrok.cc"),r=(0,e._)("li",null,[(0,e._)("p",null,[(0,e.Uk)("修改 webpack-dev-server 的 "),(0,e._)("code",null,"disableHostCheck: true")])],-1),u=(0,e._)("h2",{id:"移动端调试神器",tabindex:"-1"},[(0,e._)("a",{class:"header-anchor",href:"#移动端调试神器","aria-hidden":"true"},"#"),(0,e.Uk)(" 移动端调试神器")],-1),i=(0,e._)("ul",null,[(0,e._)("li",null,"VConsole：https://github.com/Tencent/vConsole")],-1),k=(0,e._)("h2",{id:"微信公众号开发文档",tabindex:"-1"},[(0,e._)("a",{class:"header-anchor",href:"#微信公众号开发文档","aria-hidden":"true"},"#"),(0,e.Uk)(" 微信公众号开发文档")],-1),d={href:"https://developers.weixin.qq.com/doc/offiaccount/Getting_Started/Overview.html3",target:"_blank",rel:"noopener noreferrer"},m=(0,e.Uk)("公众号开发文档"),b={href:"https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/JS-SDK.html",target:"_blank",rel:"noopener noreferrer"},h=(0,e.Uk)("JS-WX-SDK 文档"),g=(0,e.uE)('<h2 id="如何让网页只在微信内打开" tabindex="-1"><a class="header-anchor" href="#如何让网页只在微信内打开" aria-hidden="true">#</a> 如何让网页只在微信内打开</h2><ol><li><p>通过 userAgent 判断</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 判断是否是微信环境</span>\n<span class="token keyword">function</span> <span class="token function">getIsWxClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> ua <span class="token operator">=</span> navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>ua<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">MicroMessenger</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;micromessenger&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li></ol><ol start="2"><li><p>通过 WeixinJSBridge 判断(推荐)</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 需要在JS-SDK加载之后判断</span>\n<span class="token keyword">function</span> <span class="token function">getIsWxClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> WeixinJSBridge <span class="token operator">!==</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li></ol><h2 id="公众号内保持登录状态" tabindex="-1"><a class="header-anchor" href="#公众号内保持登录状态" aria-hidden="true">#</a> 公众号内保持登录状态</h2><p>微信内网页不可使用 local/sessionStorage 储存，因为它只是一个 webview 组件，并不是一个浏览器。 但是我们可以使用 cookie 储存的方式</p><p>参考：关于微信中的 localStorage 及使用 cookie 的解决方案：https://my.oschina.net/crazymus/blog/425650</p><p>方法：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//设置cookie</span>\n<span class="token keyword">function</span> <span class="token function">setCookie</span><span class="token punctuation">(</span><span class="token parameter">c_name<span class="token punctuation">,</span> value<span class="token punctuation">,</span> expiredays</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> exdate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  exdate<span class="token punctuation">.</span><span class="token function">setDate</span><span class="token punctuation">(</span>exdate<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> expiredays<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  document<span class="token punctuation">.</span>cookie <span class="token operator">=</span>\n    c_name <span class="token operator">+</span>\n    <span class="token string">&quot;=&quot;</span> <span class="token operator">+</span>\n    <span class="token function">escape</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">+</span>\n    <span class="token punctuation">(</span>expiredays <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token string">&quot;&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;;expires=&quot;</span> <span class="token operator">+</span> exdate<span class="token punctuation">.</span><span class="token function">toGMTString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">//取回cookie</span>\n<span class="token keyword">function</span> <span class="token function">getCookie</span><span class="token punctuation">(</span><span class="token parameter">c_name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>cookie<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> c_start <span class="token operator">=</span> document<span class="token punctuation">.</span>cookie<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>c_name <span class="token operator">+</span> <span class="token string">&quot;=&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>c_start <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      c_start <span class="token operator">=</span> c_start <span class="token operator">+</span> c_name<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>\n      c_end <span class="token operator">=</span> document<span class="token punctuation">.</span>cookie<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;;&quot;</span><span class="token punctuation">,</span> c_start<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>c_end <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> c_end <span class="token operator">=</span> document<span class="token punctuation">.</span>cookie<span class="token punctuation">.</span>length<span class="token punctuation">;</span>\n      <span class="token keyword">return</span> <span class="token function">unescape</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>cookie<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>c_start<span class="token punctuation">,</span> c_end<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">return</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>使用</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//设置cookie，有效期为365天</span>\n<span class="token function">setCookie</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">,</span> <span class="token number">365</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">//取回，若cookie失效，将返回空</span>\n<span class="token function">getCookie</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>同样的，也可以做登录状态保存。</p><h2 id="ios-端的时间格式问题" tabindex="-1"><a class="header-anchor" href="#ios-端的时间格式问题" aria-hidden="true">#</a> ios 端的时间格式问题</h2><p>在做移动端开发的时候，使用 new Date() 转换后台返回的格式时，在 chrome 之类浏览器和安卓手机上都显示正常，但是在 iOS 上显示 Invalid Date。 例如: <code>new Date(“2020-05-25 11:11:11”).getTime()</code> 正常情况下可以获取时间戳，但是在 iOS 端解析不了。<br> 后来查找发现 iOS 只识别 <code>yyyy/mm/dd</code> 这类斜杠格式的日期。<br> 解决办法：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>freedomTime <span class="token operator">=</span> freedomTime<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">-</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>freedomTime<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="判断设备" tabindex="-1"><a class="header-anchor" href="#判断设备" aria-hidden="true">#</a> 判断设备</h2>',15),_=(0,e.Uk)("需要解决 iOS 和安卓的兼容，首先你的判断当前的设备类型，可以使用"),f={href:"http://nodei.co/npm/mobile-device-detect/",target:"_blank",rel:"noopener noreferrer"},v=(0,e.Uk)("mobile-device-detect "),w=(0,e.Uk)("这个库来判断。"),x=(0,e._)("h2",{id:"扫码关注公众号登录网站",tabindex:"-1"},[(0,e._)("a",{class:"header-anchor",href:"#扫码关注公众号登录网站","aria-hidden":"true"},"#"),(0,e.Uk)(" 扫码关注公众号登录网站")],-1),q=(0,e.Uk)("生成带参数的二维码 "),y={href:"https://developers.weixin.qq.com/doc/offiaccount/Account_Management/Generating_a_Parametric_QR_Code.html",target:"_blank",rel:"noopener noreferrer"},U=(0,e.Uk)("生成二维码"),S=(0,e.Uk)("用户扫描二维码 "),W={href:"https://developers.weixin.qq.com/doc/offiaccount/Message_Management/Receiving_event_pushes.html",target:"_blank",rel:"noopener noreferrer"},C=(0,e.Uk)("用户扫码后-获取用户 openid"),j=(0,e.Uk)("获取"),B={href:"https://developers.weixin.qq.com/doc/offiaccount/Message_Management/Receiving_event_pushes.html",target:"_blank",rel:"noopener noreferrer"},D=(0,e.Uk)("用户关注/取关推送"),E=(0,e.Uk)("获取 openid 和关注状况"),A=(0,e.Uk)("关注后获取用户 openid "),M={href:"https://developers.weixin.qq.com/doc/offiaccount/User_Management/Get_users_basic_information_UnionID.html#UinonId",target:"_blank",rel:"noopener noreferrer"},O=(0,e.Uk)("通过 openid 获取用户基本信息"),H=(0,e.Uk)("，可根据 openid 和 unionid 添加到用户信息中。"),T={href:"https://developers.weixin.qq.com/doc/offiaccount/User_Management/Getting_a_User_List.html",target:"_blank",rel:"noopener noreferrer"},G=(0,e.Uk)("获取关注者用户列表"),I=(0,e.Uk)("，可以判断与用户是否关注"),J=(0,e._)("li",null,"总结逻辑：用户通过扫码生成带有参数的二维码后可以获得微信的推送，拿到 openid 和订阅状态，然后通过 openid 可以获取 unionid 和微信基本信息，在与我们的数据做一个绑定，然后订阅之后可以获得推送，判断已经订阅就给他返回登录态（前端轮询/webStoket）。",-1),R=(0,e._)("h2",{id:"微信-h5-页面兼容的坑",tabindex:"-1"},[(0,e._)("a",{class:"header-anchor",href:"#微信-h5-页面兼容的坑","aria-hidden":"true"},"#"),(0,e.Uk)(" 微信 H5 页面兼容的坑")],-1),F=(0,e._)("ul",null,[(0,e._)("li",null,"ios 端兼容 input 光标高度"),(0,e._)("li",null,"ios 端微信 H5 上下滑动时卡顿，页面丢失"),(0,e._)("li",null,"ios 键盘唤起，键盘收起以后页面不归位"),(0,e._)("li",null,"安卓弹出的键盘遮盖文本框"),(0,e._)("li",null,"Vue 中路由使用 hash 模式，开发微信 H5 页面分享时在安卓上设置分享成功，但是 ios 的分享异常")],-1),K=(0,e.Uk)("这五个问题可以在 "),L={href:"https://segmentfault.com/a/1190000019986963",target:"_blank",rel:"noopener noreferrer"},P=(0,e.Uk)("微信 H5 页面前端开发，大多数人都会遇到的几个兼容性坑"),V=(0,e.Uk)(" 中查看原因和解决方法"),z={render:function(n,s){const a=(0,e.up)("OutboundLink");return(0,e.wg)(),(0,e.iD)(e.HY,null,[p,t,(0,e._)("ul",null,[(0,e._)("li",null,[(0,e._)("p",null,[o,(0,e._)("a",l,[c,(0,e.Wm)(a)])])]),r]),u,i,k,(0,e._)("ul",null,[(0,e._)("li",null,[(0,e._)("a",d,[m,(0,e.Wm)(a)])]),(0,e._)("li",null,[(0,e._)("a",b,[h,(0,e.Wm)(a)])])]),g,(0,e._)("p",null,[_,(0,e._)("a",f,[v,(0,e.Wm)(a)]),w]),x,(0,e._)("ol",null,[(0,e._)("li",null,[q,(0,e._)("ol",null,[(0,e._)("li",null,[(0,e._)("a",y,[U,(0,e.Wm)(a)])])])]),(0,e._)("li",null,[S,(0,e._)("ol",null,[(0,e._)("li",null,[(0,e._)("a",W,[C,(0,e.Wm)(a)]),j]),(0,e._)("li",null,[(0,e._)("a",B,[D,(0,e.Wm)(a)]),E])])]),(0,e._)("li",null,[A,(0,e._)("ol",null,[(0,e._)("li",null,[(0,e._)("a",M,[O,(0,e.Wm)(a)]),H]),(0,e._)("li",null,[(0,e._)("a",T,[G,(0,e.Wm)(a)]),I])])]),J]),R,F,(0,e._)("p",null,[K,(0,e._)("a",L,[P,(0,e.Wm)(a)]),V])],64)}}}}]);